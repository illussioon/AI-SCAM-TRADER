# –°–∏—Å—Ç–µ–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ Royal APL

## –û–ø–∏—Å–∞–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. API Server (`api-server/main.py`)
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:**
  - `POST /api/deposit/create` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
  - `GET /api/deposit/status/{request_id}` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–ø—Ä–æ—Å–∞
  - `GET /api/deposit/last/{telegram_id}` - –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `POST /api/deposit/approve` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
  
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
  - `GET /api/notifications/pending` - –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  - `DELETE /api/notifications/{id}` - –û—Ç–º–µ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ

### 2. Telegram Bot (`main_bot.py`)
- **–§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback:**
  - `deposit_approve_{request_id}` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
  - `deposit_reject_{request_id}` - –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è

### 3. Frontend (`webapp/src/composables/deposit.js`)
- **–§—É–Ω–∫—Ü–∏–∏:**
  - `createDepositRequest()` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
  - `getDepositStatus()` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–ø—Ä–æ—Å–∞
  - `subscribeToStatusUpdates()` - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –ë–î

–í—ã–ø–æ–ª–Ω–∏—Ç–µ POST –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–ª–µ–¥—É—é—â–∏–º endpoint'–∞–º:

```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É deposit_requests
POST http://127.0.0.1:8000/debug/table/deposit_requests/create

# –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É notifications_queue
POST http://127.0.0.1:8000/debug/table/notifications_queue/create
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–û–±–Ω–æ–≤–∏—Ç–µ `config.py`:

```python
# –°–ø–∏—Å–æ–∫ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
ADMIN_IDS = [851069605, 123456789]  # –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ ID

# –ü—Ä–æ—Ü–µ–Ω—Ç –±–æ–Ω—É—Å–∞ —Ä–µ—Ñ–µ—Ä–µ—Ä—É
REFERRAL_BONUS_PERCENT = 2.7

# –ü—Ä–æ—Ü–µ–Ω—Ç –±–æ–Ω—É—Å–∞ –ø—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏
DEPOSIT_BONUS_PERCENT = 10.0
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ API —Å–µ—Ä–≤–µ—Ä
python main_bot.py
```

## –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
```javascript
import { useDeposit } from '@/composables/deposit';

const { createDepositRequest } = useDeposit();

await createDepositRequest(
  telegramId,      // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
  1000,            // –°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
  '–°–ë–ü',          // –¢–∏–ø –æ–ø–ª–∞—Ç—ã
  { /* –¥–µ—Ç–∞–ª–∏ */ } // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
);
```

### 2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
–°—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:

```
üí∞ –ù–æ–≤–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ

–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏: –°–ë–ü
–°—É–º–º–∞: 1000‚ÇΩ
–°—É–º–º–∞ —Å —É—á—ë—Ç–æ–º –±–æ–Ω—É—Å–æ–≤: 1100‚ÇΩ
–ë–æ–Ω—É—Å: +100‚ÇΩ (10%)

User ID: 123456789
Username: @username

–ó–∞–ø—Ä–æ—Å ID: 42

[‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ]
[‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ]
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–¥–º–∏–Ω–æ–º

**–ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏:**
- –î–µ–Ω—å–≥–∏ –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –±–æ–Ω—É—Å–æ–º 10%)
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–µ–π-—Ç–æ —Ä–µ—Ñ–µ—Ä–∞–ª ‚Üí —Ä–µ—Ñ–µ—Ä–µ—Ä—É –∑–∞—á–∏—Å–ª—è–µ—Ç—Å—è 2.7% –æ—Ç —Å—É–º–º—ã –ë–ï–ó –±–æ–Ω—É—Å–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏—Ö–æ–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏

**–ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏—Ö–æ–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—Ç–∫–∞–∑–µ
- –î–µ–Ω—å–≥–∏ –ù–ï –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è

### 4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:**
```
‚úÖ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ!

–ù–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å –∑–∞—á–∏—Å–ª–µ–Ω–æ: 1100‚ÇΩ
–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞!
```

**–û—Ç–∫–∞–∑:**
```
‚ùå –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤–∞—à –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±—ã–ª –æ—Ç–∫–ª–æ–Ω–µ–Ω.
–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É.
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

```javascript
import { useDeposit } from '@/composables/deposit';

const { subscribeToStatusUpdates } = useDeposit();

// –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
const unsubscribe = subscribeToStatusUpdates(requestId, (status) => {
  if (status.status === 'approved') {
    // –ü–æ–∫–∞–∑–∞—Ç—å popup –æ–± —É—Å–ø–µ—Ö–µ
    showSuccessPopup(status.total_amount);
  } else if (status.status === 'rejected') {
    // –ü–æ–∫–∞–∑–∞—Ç—å popup –æ–± –æ—Ç–∫–∞–∑–µ
    showErrorPopup();
  }
});

// –û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –∫–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–Ω–∞
// unsubscribe();
```

## –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

–ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –±–æ–Ω—É—Å —Ä–µ—Ñ–µ—Ä–µ—Ä—É:

- **–ü—Ä–æ—Ü–µ–Ω—Ç:** 2.7% –æ—Ç —Å—É–º–º—ã –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –ë–ï–ó —É—á–µ—Ç–∞ –±–æ–Ω—É—Å–∞
- **–ü—Ä–∏–º–µ—Ä:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–æ–ª–Ω–∏–ª –Ω–∞ 1000‚ÇΩ ‚Üí —Ä–µ—Ñ–µ—Ä–µ—Ä—É –ø—Ä–∏–¥–µ—Ç 27‚ÇΩ
- **–ó–∞—á–∏—Å–ª–µ–Ω–∏–µ:** –ù–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å –∏ `partners_balance`

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `money_log`:

- `dep` - –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ (—Å –±–æ–Ω—É—Å–æ–º)
- `dep_ref` - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å
- `withdraw` - –í—ã–≤–æ–¥ —Å –±–∞–ª–∞–Ω—Å–∞

## –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```bash
GET http://127.0.0.1:8000/api/notifications/pending
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
```sql
SELECT * FROM deposit_requests WHERE status = 'pending';
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥ –¥–µ–Ω–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
```bash
GET http://127.0.0.1:8000/api/money-log/history?telegram_id=123456789
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –∏–∑ `ADMIN_IDS` –º–æ–≥—É—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å/–æ—Ç–∫–ª–æ–Ω—è—Ç—å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–ø—Ä–æ—Å–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π (–Ω–µ–ª—å–∑—è –¥–≤–∞–∂–¥—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å)
- ‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ë–î

## –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **WebSocket –≤–º–µ—Å—Ç–æ polling** - –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. **–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–æ–≤** - –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª/–æ—Ç–∫–ª–æ–Ω–∏–ª
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
4. **–õ–∏–º–∏—Ç—ã –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ** - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞
5. **Cooldown –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –°–æ–∑–¥–∞–Ω—ã –ª–∏ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î
2. –ó–∞–ø—É—â–µ–Ω –ª–∏ –±–æ—Ç –∏ API —Å–µ—Ä–≤–µ—Ä
3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã –ª–∏ `ADMIN_IDS` –≤ config.py
4. –ï—Å—Ç—å –ª–∏ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±–æ—Ç–∞

