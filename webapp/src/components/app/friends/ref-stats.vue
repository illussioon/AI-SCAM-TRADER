<template>
    <div class="flex flex-col -mt-1">
      <!-- Active Partners Row -->
      <div 
        class="h-[50px] border border-[#2A2B2D] rounded-t-[20px] px-5 flex justify-between items-center" 
        style="background: linear-gradient(178.77deg, rgb(20, 21, 24), rgb(30, 32, 37) 100%) rgb(19, 20, 23);"
      >
        <div class="flex gap-x-3">
          <svg viewBox="0 0 26 26" xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="none">
            <rect width="26" height="26" x="0" y="0" fill="rgb(255,255,255)" fill-opacity="0"></rect>
            <path d="M20.281 4.06307C19.9907 4.08568 19.7131 4.19235 19.4824 4.37005C19.2516 4.54776 19.0775 4.7888 18.9815 5.06377C18.8854 5.33873 18.8714 5.63572 18.9413 5.91848C19.0112 6.20124 19.1619 6.45753 19.375 6.65607C20.2091 7.48836 20.8703 8.4773 21.3208 9.56604C21.7713 10.6548 22.0021 11.8218 22 13.0001C22.0016 14.1782 21.7705 15.3451 21.32 16.4338C20.8696 17.5224 20.2086 18.5114 19.375 19.3441C19.2302 19.4824 19.1145 19.6483 19.0346 19.832C18.9548 20.0157 18.9125 20.2135 18.9102 20.4137C18.9079 20.614 18.9456 20.8127 19.0212 20.9982C19.0968 21.1837 19.2087 21.3522 19.3503 21.4938C19.4919 21.6354 19.6604 21.7473 19.8459 21.8229C20.0314 21.8985 20.2301 21.9362 20.4304 21.9339C20.6307 21.9316 20.8284 21.8893 21.0121 21.8095C21.1958 21.7297 21.3617 21.6139 21.5 21.4691C23.7418 19.2206 25.0006 16.1751 25.0006 13.0001C25.0006 9.82504 23.7418 6.77952 21.5 4.53107C21.3629 4.38613 21.1983 4.27 21.0158 4.18947C20.8333 4.10894 20.6365 4.06562 20.437 4.06207C20.3851 4.06004 20.333 4.06004 20.281 4.06207L20.281 4.06307ZM5.37504 4.09307C5.04261 4.13716 4.73455 4.29137 4.50004 4.53107C2.25833 6.77952 0.999512 9.82504 0.999512 13.0001C0.999512 16.1751 2.25833 19.2206 4.50004 21.4691C4.63837 21.6139 4.80425 21.7297 4.98794 21.8095C5.17163 21.8893 5.36943 21.9316 5.5697 21.9339C5.76998 21.9362 5.96869 21.8985 6.15417 21.8229C6.33965 21.7473 6.50815 21.6354 6.64978 21.4938C6.7914 21.3522 6.90329 21.1837 6.97888 20.9982C7.05446 20.8127 7.0922 20.614 7.0899 20.4137C7.08759 20.2135 7.04528 20.0157 6.96545 19.832C6.88562 19.6483 6.76989 19.4824 6.62504 19.3441C5.79102 18.5118 5.12976 17.5228 4.67927 16.4341C4.22877 15.3454 3.99794 14.1783 4.00004 13.0001C3.99849 11.8219 4.22957 10.655 4.68003 9.56635C5.13049 8.47769 5.79147 7.48869 6.62504 6.65607C6.85179 6.43586 7.00318 6.14965 7.05761 5.83829C7.11204 5.52693 7.06672 5.20633 6.92812 4.92226C6.78952 4.63818 6.56472 4.40515 6.28582 4.25643C6.00692 4.1077 5.68816 4.04988 5.37504 4.09307ZM9.18804 7.40607C8.85915 7.44143 8.55118 7.58452 8.31204 7.81307C7.58566 8.46814 7.00462 9.26817 6.6064 10.1616C6.20818 11.055 6.00162 12.0219 6.00004 13.0001C6.00004 15.0481 6.87004 16.9101 8.28104 18.1881C8.42681 18.3214 8.59741 18.4248 8.78312 18.4922C8.96882 18.5596 9.16599 18.5898 9.36336 18.581C9.56073 18.5723 9.75444 18.5247 9.93343 18.441C10.1124 18.3574 10.2732 18.2393 10.4065 18.0936C10.5399 17.9478 10.6432 17.7772 10.7107 17.5915C10.7781 17.4058 10.8083 17.2086 10.7995 17.0112C10.7907 16.8139 10.7432 16.6202 10.6595 16.4412C10.5759 16.2622 10.4578 16.1014 10.312 15.9681C9.89714 15.5933 9.56587 15.1352 9.33981 14.6239C9.11375 14.1125 8.99798 13.5592 9.00004 13.0001C8.99797 12.4407 9.11383 11.8872 9.34007 11.3756C9.5663 10.864 9.89783 10.4059 10.313 10.0311C10.5527 9.82259 10.72 9.54341 10.7908 9.23376C10.8616 8.92411 10.8323 8.59998 10.707 8.30806C10.5818 8.01614 10.3672 7.77151 10.094 7.60941C9.82084 7.44731 9.50426 7.37611 9.18804 7.40607ZM16.594 7.40607C16.2966 7.42247 16.0107 7.52709 15.7729 7.70658C15.5351 7.88608 15.3562 8.13233 15.2589 8.41393C15.1616 8.69553 15.1503 8.99972 15.2266 9.28773C15.3028 9.57574 15.4631 9.83452 15.687 10.0311C16.1022 10.4059 16.4338 10.864 16.66 11.3756C16.8862 11.8872 17.0021 12.4407 17 13.0001C17.0021 13.5594 16.8862 14.113 16.66 14.6245C16.4338 15.1361 16.1022 15.5942 15.687 15.9691C15.5199 16.0939 15.3806 16.2522 15.2781 16.4339C15.1757 16.6156 15.1122 16.8167 15.0918 17.0243C15.0714 17.2319 15.0946 17.4415 15.1597 17.6396C15.2249 17.8378 15.3307 18.0202 15.4704 18.1751C15.6101 18.3301 15.7805 18.4542 15.9709 18.5396C16.1612 18.6249 16.3673 18.6696 16.5759 18.6709C16.7845 18.6721 16.991 18.6298 17.1824 18.5466C17.3737 18.4635 17.5456 18.3414 17.687 18.1881C18.4137 17.533 18.995 16.7328 19.3934 15.8392C19.7918 14.9456 19.9985 13.9784 20 13.0001C20.0038 12.0239 19.8027 11.0578 19.4098 10.1642C19.0169 9.27052 18.4409 8.46924 17.719 7.81207C17.5694 7.67085 17.3923 7.56194 17.1988 7.49209C17.0052 7.42225 16.7994 7.39297 16.594 7.40607ZM13 11.1881C12.6417 11.1883 12.2915 11.2947 11.9936 11.4939C11.6958 11.6932 11.4637 11.9762 11.3267 12.3073C11.1897 12.6385 11.1539 13.0028 11.224 13.3542C11.294 13.7056 11.4667 14.0284 11.7201 14.2817C11.9736 14.535 12.2964 14.7075 12.6479 14.7773C12.9994 14.8472 13.3637 14.8112 13.6947 14.674C14.0257 14.5369 14.3087 14.3046 14.5077 14.0067C14.7068 13.7087 14.813 13.3584 14.813 13.0001C14.8134 12.7619 14.7668 12.5259 14.6758 12.3058C14.5849 12.0857 14.4513 11.8856 14.2829 11.7172C14.1145 11.5488 13.9145 11.4152 13.6943 11.3243C13.4742 11.2333 13.2382 11.1877 13 11.1881Z" fill="rgb(255,255,255)" fill-rule="nonzero"></path>
          </svg>
          <p class="text-[20px] font-semibold">Активных партнеров: </p>
        </div>
        <p class="text-[20px]">{{ activePartners }}</p>
      </div>
  
      <!-- Level 1 Partners Row -->
      <div 
        class="h-[50px] border border-[#2A2B2D] px-5 flex justify-between items-center" 
        style="background: linear-gradient(178.77deg, rgb(20, 21, 24), rgb(30, 32, 37) 100%) rgb(19, 20, 23);"
      >
        <div class="flex gap-x-3">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none">
            <rect width="24" height="24" x="0" y="0" fill="rgb(255,255,255)" fill-opacity="0"></rect>
            <path d="M4 22C4 19.8783 4.84285 17.8434 6.34315 16.3431C7.84344 14.8429 9.87827 14 12 14C14.1217 14 16.1566 14.8429 17.6569 16.3431C19.1571 17.8434 20 19.8783 20 22L4 22ZM12 13C8.685 13 6 10.315 6 7C6 3.685 8.685 1 12 1C15.315 1 18 3.685 18 7C18 10.315 15.315 13 12 13Z" fill="rgb(255,255,255)" fill-rule="nonzero"></path>
          </svg>
          <p class="text-[20px] font-semibold">Партнеров первого уровня: </p>
        </div>
        <p class="text-[20px]">{{ level1Partners }}</p>
      </div>
  
      <!-- Level 2-3 Partners Row -->
      <div 
        class="h-[50px] border border-[#2A2B2D] rounded-b-[20px] px-5 flex justify-between items-center" 
        style="background: linear-gradient(178.77deg, rgb(20, 21, 24), rgb(30, 32, 37) 100%) rgb(19, 20, 23);"
      >
        <div class="flex gap-x-3">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none">
            <rect width="24" height="24" x="0" y="0" fill="rgb(255,255,255)" fill-opacity="0"></rect>
            <g>
              <path d="M12 4.5C12 3.90905 12.1164 3.32389 12.3425 2.77792C12.5687 2.23196 12.9002 1.73588 13.318 1.31802C13.7359 0.900156 14.232 0.568688 14.7779 0.342542C15.3239 0.116396 15.9091 0 16.5 0C17.0909 6.245e-17 17.6761 0.116396 18.2221 0.342542C18.768 0.568688 19.2641 0.900156 19.682 1.31802C20.0998 1.73588 20.4313 2.23196 20.6575 2.77792C20.8836 3.32389 21 3.90905 21 4.5C21 5.69347 20.5259 6.83807 19.682 7.68198C18.8381 8.52589 17.6935 9 16.5 9C15.3065 9 14.1619 8.52589 13.318 7.68198C12.4741 6.83807 12 5.69347 12 4.5ZM0 19.5C3.747e-16 18.3065 0.474106 17.1619 1.31802 16.318C2.16193 15.4741 3.30653 15 4.5 15L10.5 15C11.6935 15 12.8381 15.4741 13.682 16.318C14.5259 17.1619 15 18.3065 15 19.5L15 24L0 24L0 19.5Z" fill="rgb(255,255,255)" fill-rule="nonzero"></path>
              <path d="M13.3095 10.5045C13.0001 11.6977 12.3308 12.7666 11.3925 13.566C12.8133 13.7797 14.1102 14.4962 15.0475 15.5851C15.9848 16.6741 16.5002 18.0632 16.5 19.5L24 19.5L24 15C24 13.8065 23.5259 12.6619 22.682 11.818C21.8381 10.9741 20.6935 10.5 19.5 10.5L13.5 10.5C13.437 10.5 13.3735 10.5015 13.3095 10.5045ZM7.5 4.5C6.30653 4.5 5.16193 4.97411 4.31802 5.81802C3.47411 6.66193 3 7.80653 3 9C3 10.1935 3.47411 11.3381 4.31802 12.182C5.16193 13.0259 6.30653 13.5 7.5 13.5C8.69347 13.5 9.83807 13.0259 10.682 12.182C11.5259 11.3381 12 10.1935 12 9C12 7.80653 11.5259 6.66193 10.682 5.81802C9.83807 4.97411 8.69347 4.5 7.5 4.5Z" fill="rgb(255,255,255)" fill-rule="nonzero"></path>
            </g>
          </svg>
          <p class="text-[20px] font-semibold">Партнеров 2-3 уровня: </p>
        </div>
        <p class="text-[20px]">{{ level23Partners }}</p>
      </div>
    </div>
  </template>
  
<script setup>
import { computed, onMounted } from 'vue'
import { useUserStore } from '../../../stores/user.js'

const userStore = useUserStore()

// Получаем данные из store
const activePartners = computed(() => userStore.referralData.activePartners)
const level1Partners = computed(() => userStore.referralData.level1Partners)
const level23Partners = computed(() => userStore.referralData.level23Partners)

// Загружаем данные при монтировании компонента
onMounted(async () => {
  // Если данные не инициализированы или устарели, загружаем их
  if (!userStore.referralLastUpdated || 
      (Date.now() - userStore.referralLastUpdated.getTime() > 60000)) { // 1 минута кеша
    await userStore.fetchReferralData()
  }
})
</script>