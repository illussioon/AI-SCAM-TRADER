<template>
  <div class="flex flex-col h-[287px] relative overflow-hidden mt-2 rounded-[10px]">
    <svg
      width="365"
      height="287"
      viewBox="0 0 365 287"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      class="absolute inset-0 w-full h-full"
      preserveAspectRatio="xMidYMid slice"
      style="width: 100%; height: 100%; object-fit: cover;"
    >
      <g clip-path="url(#clip0_995_2997)">
        <rect width="365" height="287" rx="11" fill="white"></rect>
        <rect x="0.5" y="0.5" width="364" height="299" rx="9.5" fill="#131417" stroke="#2A2B2D"></rect>
        <rect width="448" height="365" transform="translate(-51 -53)" fill="black" fill-opacity="0.01"></rect>
        <path
          opacity="0.2"
          d="M15.9578 218.132C53.3924 178.095 37.2992 184.341 75.7361 185.393C114.173 186.445 85.4105 203.356 133.612 173.93C181.813 144.504 180.128 154.013 217.302 148.689C254.476 143.364 246.06 134.327 267.068 122.011C288.075 109.695 300.128 113.934 328.362 117.516C356.596 121.099 352.123 101.087 370.979 85.6288C389.835 70.1707 405.738 60.3944 420.73 66.6C435.721 72.8056 414.048 74.0399 459.195 52.355C495.313 35.007 517.334 180.331 523.831 255.162L45.7815 368.706L15.9578 218.132Z"
          fill="url(#paint0_linear_995_2997)"
          fill-opacity="0.2"
          stroke="#90F705"
          stroke-opacity="0.2"
          stroke-width="2"
        ></path>
        <g filter="url(#filter1_f_995_2997)">
          <rect x="-40" y="121" width="172" height="229" fill="#151619"></rect>
        </g>
        <g filter="url(#filter2_f_995_2997)">
          <rect x="89" y="180" width="320" height="170" fill="#151619"></rect>
        </g>
        <g opacity="0.3" filter="url(#filter3_f_995_2997)">
          <rect x="-17" y="193" width="401" height="26" fill="white"></rect>
        </g>
        <g filter="url(#filter4_f_995_2997)">
          <rect width="87" height="59" transform="matrix(-1 0 0 1 43 175)" fill="#92F509"></rect>
        </g>
        <g filter="url(#filter5_f_995_2997)">
          <rect width="120" height="38" transform="matrix(-1 0 0 1 401 3)" fill="#92F509"></rect>
        </g>
      </g>
      <defs>
        <filter
          id="filter1_f_995_2997"
          x="-74.8"
          y="86.2"
          width="241.6"
          height="298.6"
          filterUnits="userSpaceOnUse"
          color-interpolation-filters="sRGB"
        >
          <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
          <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
          <feGaussianBlur stdDeviation="17.4" result="effect1_foregroundBlur_995_2997"></feGaussianBlur>
        </filter>
        <filter
          id="filter2_f_995_2997"
          x="54.2"
          y="145.2"
          width="389.6"
          height="239.6"
          filterUnits="userSpaceOnUse"
          color-interpolation-filters="sRGB"
        >
          <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
          <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
          <feGaussianBlur stdDeviation="17.4" result="effect1_foregroundBlur_995_2997"></feGaussianBlur>
        </filter>
        <filter
          id="filter3_f_995_2997"
          x="-156.5"
          y="53.5"
          width="680"
          height="305"
          filterUnits="userSpaceOnUse"
          color-interpolation-filters="sRGB"
        >
          <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
          <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
          <feGaussianBlur stdDeviation="69.75" result="effect1_foregroundBlur_995_2997"></feGaussianBlur>
        </filter>
        <filter
          id="filter4_f_995_2997"
          x="-163.3"
          y="55.7"
          width="325.6"
          height="297.6"
          filterUnits="userSpaceOnUse"
          color-interpolation-filters="sRGB"
        >
          <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
          <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
          <feGaussianBlur stdDeviation="59.65" result="effect1_foregroundBlur_995_2997"></feGaussianBlur>
        </filter>
        <filter
          id="filter5_f_995_2997"
          x="161.7"
          y="-116.3"
          width="358.6"
          height="276.6"
          filterUnits="userSpaceOnUse"
          color-interpolation-filters="sRGB"
        >
          <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
          <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
          <feGaussianBlur stdDeviation="59.65" result="effect1_foregroundBlur_995_2997"></feGaussianBlur>
        </filter>
        <linearGradient
          id="paint0_linear_995_2997"
          x1="244.889"
          y1="94.3063"
          x2="289.671"
          y2="320.4"
          gradientUnits="userSpaceOnUse"
        >
          <stop stop-color="#90F705"></stop>
          <stop offset="1" stop-color="#559103" stop-opacity="0"></stop>
        </linearGradient>
        <clipPath id="clip0_995_2997">
          <rect width="365" height="287" rx="11" fill="white"></rect>
        </clipPath>
      </defs>
    </svg>
    <div class="relative z-10 flex flex-col h-full">
      <div class="flex items-center justify-between pr-5">
        <div class="flex items-center">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            class="ml-3 mb-[10px]"
          >
            <g filter="url(#filter0_i_2177_1547)">
              <path
                d="M21.6592 12.8154C21.6992 12.7952 21.7596 12.7852 21.8096 12.8154C21.8964 12.8642 21.8993 12.9791 21.8994 12.9873L21.8193 18.1523C21.8191 20.2787 20.1185 22 18.0176 22H5.97168C3.87097 21.9998 2.17015 20.2786 2.16992 18.1523L2.09961 12.9873C2.09972 12.9792 2.10319 12.8644 2.18945 12.8154C2.26941 12.7648 2.36971 12.8257 2.37988 12.8359C4.40066 14.1927 6.83188 15.094 9.38281 15.4688C9.74284 15.5194 10.1039 15.2862 10.2041 14.9219C10.4242 14.0918 11.1343 13.5452 11.9844 13.5449H12.0146C12.865 13.545 13.5758 14.0915 13.7959 14.9219C13.896 15.2861 14.2563 15.5191 14.6162 15.4688C17.1671 15.0941 19.5984 14.1926 21.6191 12.8359C21.6191 12.8359 21.6394 12.8255 21.6592 12.8154ZM11.9941 14.9932C11.5844 14.9936 11.2443 15.3372 11.2441 15.752V17.0586C11.2443 17.4834 11.5844 17.8179 11.9941 17.8184C12.4142 17.8184 12.7449 17.4837 12.7451 17.0586V15.752C12.7449 15.3369 12.4142 14.9932 11.9941 14.9932ZM13.2852 2C14.7858 2 16.0168 3.14412 16.207 4.6123H18.1885C20.2893 4.61252 21.9999 6.34433 22 8.4707C22 8.4707 21.9399 9.37134 21.9199 10.625C21.9179 10.7241 21.8699 10.8212 21.791 10.8799C21.3098 11.2353 20.8691 11.5296 20.8291 11.5498C19.1684 12.6636 17.2385 13.4471 15.1826 13.8369C15.0486 13.8632 14.9167 13.7933 14.8486 13.6738C14.2724 12.6754 13.1957 12.0254 11.9951 12.0254C10.8026 12.0254 9.71635 12.6685 9.12305 13.668C9.05401 13.7854 8.92311 13.8534 8.79004 13.8281C6.75124 13.4372 4.82159 12.6541 3.1709 11.5596L2.20996 10.8906C2.1302 10.84 2.0802 10.7494 2.08008 10.6484C2.05006 10.132 2 8.4707 2 8.4707C2.00008 6.34433 3.7107 4.61251 5.81152 4.6123H7.7832C7.97345 3.14422 9.20359 2.00013 10.7041 2H13.2852ZM10.7041 3.51855C10.034 3.51867 9.46389 3.98471 9.30371 4.6123H14.6865C14.5263 3.9846 13.9554 3.51855 13.2852 3.51855H10.7041Z"
                fill="#BBFF30"
              ></path>
              <path
                d="M21.6592 12.8154C21.6992 12.7952 21.7596 12.7852 21.8096 12.8154C21.8964 12.8642 21.8993 12.9791 21.8994 12.9873L21.8193 18.1523C21.8191 20.2787 20.1185 22 18.0176 22H5.97168C3.87097 21.9998 2.17015 20.2786 2.16992 18.1523L2.09961 12.9873C2.09972 12.9792 2.10319 12.8644 2.18945 12.8154C2.26941 12.7648 2.36971 12.8257 2.37988 12.8359C4.40066 14.1927 6.83188 15.094 9.38281 15.4688C9.74284 15.5194 10.1039 15.2862 10.2041 14.9219C10.4242 14.0918 11.1343 13.5452 11.9844 13.5449H12.0146C12.865 13.545 13.5758 14.0915 13.7959 14.9219C13.896 15.2861 14.2563 15.5191 14.6162 15.4688C17.1671 15.0941 19.5984 14.1926 21.6191 12.8359C21.6191 12.8359 21.6394 12.8255 21.6592 12.8154ZM11.9941 14.9932C11.5844 14.9936 11.2443 15.3372 11.2441 15.752V17.0586C11.2443 17.4834 11.5844 17.8179 11.9941 17.8184C12.4142 17.8184 12.7449 17.4837 12.7451 17.0586V15.752C12.7449 15.3369 12.4142 14.9932 11.9941 14.9932ZM13.2852 2C14.7858 2 16.0168 3.14412 16.207 4.6123H18.1885C20.2893 4.61252 21.9999 6.34433 22 8.4707C22 8.4707 21.9399 9.37134 21.9199 10.625C21.9179 10.7241 21.8699 10.8212 21.791 10.8799C21.3098 11.2353 20.8691 11.5296 20.8291 11.5498C19.1684 12.6636 17.2385 13.4471 15.1826 13.8369C15.0486 13.8632 14.9167 13.7933 14.8486 13.6738C14.2724 12.6754 13.1957 12.0254 11.9951 12.0254C10.8026 12.0254 9.71635 12.6685 9.12305 13.668C9.05401 13.7854 8.92311 13.8534 8.79004 13.8281C6.75124 13.4372 4.82159 12.6541 3.1709 11.5596L2.20996 10.8906C2.1302 10.84 2.0802 10.7494 2.08008 10.6484C2.05006 10.132 2 8.4707 2 8.4707C2.00008 6.34433 3.7107 4.61251 5.81152 4.6123H7.7832C7.97345 3.14422 9.20359 2.00013 10.7041 2H13.2852ZM10.7041 3.51855C10.034 3.51867 9.46389 3.98471 9.30371 4.6123H14.6865C14.5263 3.9846 13.9554 3.51855 13.2852 3.51855H10.7041Z"
                fill="url(#paint0_linear_2177_1547)"
              ></path>
            </g>
            <defs>
              <filter
                id="filter0_i_2177_1547"
                x="2"
                y="2"
                width="20"
                height="26"
                filterUnits="userSpaceOnUse"
                color-interpolation-filters="sRGB"
              >
                <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
                <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
                <feColorMatrix
                  in="SourceAlpha"
                  type="matrix"
                  values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                  result="hardAlpha"
                ></feColorMatrix>
                <feOffset dy="6"></feOffset>
                <feGaussianBlur stdDeviation="3"></feGaussianBlur>
                <feComposite in2="hardAlpha" operator="arithmetic" k2="-1" k3="1"></feComposite>
                <feColorMatrix
                  type="matrix"
                  values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.25 0"
                ></feColorMatrix>
                <feBlend mode="normal" in2="shape" result="effect1_innerShadow_2177_1547"></feBlend>
              </filter>
              <linearGradient
                id="paint0_linear_2177_1547"
                x1="12"
                y1="2"
                x2="12"
                y2="22"
                gradientUnits="userSpaceOnUse"
              >
                <stop stop-color="#B3F106"></stop>
                <stop offset="1" stop-color="#5EFF03"></stop>
              </linearGradient>
            </defs>
          </svg>
          <p class="text-[20px] -translate-y-1 ml-[6px]">Ваш кабинет:</p>
        </div>
        <div class="flex gap-x-4 items-center translate-y-4">
          <div class="relative w-[58px] h-[58px] flex items-center justify-center">
            <div
              class="absolute inset-0 rounded-full"
              style="border: 2.78px solid rgb(255, 255, 255); opacity: 0.2; width: 58px; height: 58px;"
            ></div>
            <div
              class="absolute rounded-full"
              style="width: 58px; height: 58px; box-sizing: border-box; border: 2.78px solid rgb(181, 255, 7); opacity: 0.2; filter: blur(10px);"
            ></div>
            <div
              class="absolute rounded-full"
              style="width: 58px; height: 58px; box-sizing: border-box; border: 2.78px solid rgb(181, 255, 7); opacity: 0.2; filter: blur(10px);"
            ></div>
            <div class="absolute rounded-full spinning-ring"></div>
            <div class="relative z-10">
              <svg
                viewBox="0 0 28.8264 28.8264"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                width="28.826416"
                height="28.826416"
                fill="none"
              >
                <rect
                  id="fluent:developer-board-16-filled"
                  width="28.826347"
                  height="28.826347"
                  x="0"
                  y="0"
                  fill="rgb(255,255,255)"
                  fill-opacity="0"
                ></rect>
                <path
                  id="Vector"
                  d="M26.1237 15.3139C26.3627 15.3139 26.5918 15.219 26.7607 15.05C26.9297 14.8811 27.0246 14.652 27.0246 14.413C27.0246 14.1741 26.9297 13.945 26.7607 13.7761C26.5918 13.6071 26.3627 13.5122 26.1237 13.5122L23.4213 13.5122L23.4213 10.8097L26.1237 10.8097C26.3627 10.8097 26.5918 10.7148 26.7607 10.5459C26.9297 10.377 27.0246 10.1478 27.0246 9.90892C27.0246 9.67001 26.9297 9.44088 26.7607 9.27195C26.5918 9.10301 26.3627 9.0081 26.1237 9.0081L23.4213 9.0081C23.4213 8.05245 23.0416 7.13594 22.3659 6.46019C21.6901 5.78444 20.7736 5.40481 19.818 5.40481L19.818 2.70234C19.818 2.46342 19.7231 2.2343 19.5541 2.06536C19.3852 1.89642 19.1561 1.80151 18.9172 1.80151C18.6782 1.80151 18.4491 1.89642 18.2802 2.06536C18.1112 2.2343 18.0163 2.46342 18.0163 2.70234L18.0163 5.40481L15.3139 5.40481L15.3139 2.70234C15.3139 2.46342 15.219 2.2343 15.05 2.06536C14.8811 1.89642 14.652 1.80151 14.413 1.80151C14.1741 1.80151 13.945 1.89642 13.7761 2.06536C13.6071 2.2343 13.5122 2.46342 13.5122 2.70234L13.5122 5.40481L10.8097 5.40481L10.8097 2.70234C10.8097 2.46342 10.7148 2.2343 10.5459 2.06536C10.377 1.89642 10.1478 1.80151 9.90892 1.80151C9.67001 1.80151 9.44088 1.89642 9.27195 2.06536C9.10301 2.2343 9.0081 2.46342 9.0081 2.70234L9.0081 5.40481C8.05245 5.40481 7.13594 5.78444 6.46019 6.46019C5.78444 7.13594 5.40481 8.05245 5.40481 9.0081L2.70234 9.0081C2.46342 9.0081 2.2343 9.10301 2.06536 9.27195C1.89642 9.44088 1.80151 9.67001 1.80151 9.90892C1.80151 10.1478 1.89642 10.377 2.06536 10.5459C2.2343 10.7148 2.46342 10.8097 2.70234 10.8097L5.40481 10.8097L5.40481 13.5122L2.70234 13.5122C2.46342 13.5122 2.2343 13.6071 2.06536 13.7761C1.89642 13.945 1.80151 14.1741 1.80151 14.413C1.80151 14.652 1.89642 14.8811 2.06536 15.05C2.2343 15.219 2.46342 15.3139 2.70234 15.3139L5.40481 15.3139L5.40481 18.0163L2.70234 18.0163C2.46342 18.0163 2.2343 18.1112 2.06536 18.2802C1.89642 18.4491 1.80151 18.6782 1.80151 18.9172C1.80151 19.1561 1.89642 19.3852 2.06536 19.5541C2.2343 19.7231 2.46342 19.818 2.70234 19.818L5.40481 19.818C5.40481 20.7736 5.78444 21.6901 6.46019 22.3659C7.13594 23.0416 8.05245 23.4213 9.0081 23.4213L9.0081 26.1237C9.0081 26.3627 9.10301 26.5918 9.27195 26.7607C9.44088 26.9297 9.67001 27.0246 9.90892 27.0246C10.1478 27.0246 10.377 26.9297 10.5459 26.7607C10.7148 26.5918 10.8097 26.3627 10.8097 26.1237L10.8097 23.4213L13.5122 23.4213L13.5122 26.1237C13.5122 26.3627 13.6071 26.5918 13.7761 26.7607C13.945 26.9297 14.1741 27.0246 14.413 27.0246C14.652 27.0246 14.8811 26.9297 15.05 26.7607C15.219 26.5918 15.3139 26.3627 15.3139 26.1237L15.3139 23.4213L18.0163 23.4213L18.0163 26.1237C18.0163 26.3627 18.1112 26.5918 18.2802 26.7607C18.4491 26.9297 18.6782 27.0246 18.9172 27.0246C19.1561 27.0246 19.3852 26.9297 19.5541 26.7607C19.7231 26.5918 19.818 26.3627 19.818 26.1237L19.818 23.4213C20.7736 23.4213 21.6901 23.0416 22.3659 22.3659C23.0416 21.6901 23.4213 20.7736 23.4213 19.818L26.1237 19.818C26.3627 19.818 26.5918 19.7231 26.7607 19.5541C26.9297 19.3852 27.0246 19.1561 27.0246 18.9172C27.0246 18.6782 26.9297 18.4491 26.7607 18.2802C26.5918 18.1112 26.3627 18.0163 26.1237 18.0163L23.4213 18.0163L23.4213 15.3139L26.1237 15.3139ZM14.413 18.9172C13.2185 18.9172 12.0728 18.4426 11.2281 17.5979C10.3835 16.7532 9.90892 15.6076 9.90892 14.413C9.90892 11.9286 11.9286 9.90892 14.413 9.90892C16.8975 9.90892 18.9172 11.9286 18.9172 14.413C18.9172 16.8975 16.8975 18.9172 14.413 18.9172ZM14.413 11.7106C12.9231 11.7106 11.7106 12.9231 11.7106 14.413C11.7106 15.903 12.9231 17.1155 14.413 17.1155C15.903 17.1155 17.1155 15.903 17.1155 14.413C17.1155 12.9231 15.903 11.7106 14.413 11.7106Z"
                  fill="rgb(255,255,255)"
                  fill-rule="nonzero"
                ></path>
              </svg>
            </div>
          </div>
        </div>
      </div>
      <div class="flex pl-[10px] items-center gap-x-2 -mt-4">
        <div
          class="h-[36px] w-[36px] rounded-full p-[1px]"
          style="border: 1px solid rgb(5, 139, 197);"
        >
          <div class="h-full w-full border-px border-[#18191D] rounded-full flex items-center justify-center">
            <img
              alt="TON"
              class="h-[30px] w-[30px] rounded-full object-cover"
              loading="eager"
              decoding="async"
              draggable="false"
              :src="stakeData.tariffIcon"
            />
          </div>
        </div>
        <div class="flex flex-col justify-center items-baseline -space-y-2 translate-y-[2px]">
          <p class="text-[16px] opacity-50">Тариф</p>
          <div class="flex items-baseline">
            <p class="text-[21.4px]">{{ stakeData.tariffName }}</p>
            <svg
              viewBox="0 0 13 8"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              width="13"
              height="8"
              fill="none"
              customFrame="#000000"
            >
              <path
                id="Polygon 4"
                d="M10.549 4.31579C11.1482 4.95436 10.6954 6 9.81976 6L3.18024 6C2.30462 6 1.85185 4.95436 2.45095 4.31579L5.77072 0.777328C6.16574 0.356275 6.83426 0.356275 7.22928 0.777328L10.549 4.31579Z"
                fill="rgb(255,255,255)"
                fill-rule="evenodd"
                transform="matrix(1,0,0,-1,0,8)"
              ></path>
            </svg>
          </div>
        </div>
      </div>
      <p class="text-[16px] opacity-50 pl-[10px]">Мой баланс:</p>
      <div class="flex items-baseline pl-[10px]">
        <p class="text-[33px] font-semibold">
          <span class="opacity-60">₽</span><span v-html="formatBalance(stakeData.balance)"></span>
        </p>
        <div
          class="bg-[#3A5D16] -translate-y-2 ml-2 rounded-[20px] w-[68px] h-[22px] text-[16px] flex items-center justify-center text-[#86F903] pt-[2px]"
        >
          <p>+<span>{{ stakeData.dailyProfitRate }}</span>%</p>
        </div>
      </div>
      <div class="w-[213px] h-px bg-[#FFF] ml-[10px] -mt-2"></div>
      <div class="flex justify-between px-[10px] mt-4 relative">
        <div class="relative">
          <div
            class="flex min-w-[160px] h-[41px] flex-col -space-y-2 justify-center items-center bg-[#0B0D0F] relative overflow-hidden"
            style="
              box-sizing: border-box;
              border: 0.5px solid rgba(255, 255, 255, 0.2);
              border-radius: 35px;
            "
          >
            <p class="text-[14px] opacity-50 -mt-1">Накопление</p>
            <p class="text-[18px] font-semibold">{{ formatProfit(stakeData.accumulatedProfit) }}₽</p>
            <div
              class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 pointer-events-none"
              style="
                width: 75px;
                height: 18px;
                filter: blur(40.8175px);
                background: linear-gradient(90deg, rgb(217, 217, 217) 0%, rgb(99, 102, 104) 100%);
                opacity: 0.4;
              "
            ></div>
          </div>
        </div>
        <div class="relative">
          <div
            class="flex min-w-[160px] h-[41px] flex-col -space-y-2 justify-center items-center bg-[#0B0D0F] relative overflow-hidden"
            style="
              box-sizing: border-box;
              border: 0.5px solid rgba(255, 255, 255, 0.2);
              border-radius: 35px;
            "
          >
            <p class="text-[14px] opacity-50 -mt-1">Прибыль</p>
            <p class="text-[18px] font-semibold">{{ stakeData.dailyProfitRate }}%</p>
            <div
              class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 pointer-events-none"
              style="
                width: 75px;
                height: 18px;
                filter: blur(40.8175px);
                background: linear-gradient(90deg, rgb(217, 217, 217) 0%, rgb(99, 102, 104) 100%);
                opacity: 0.4;
              "
            ></div>
          </div>
        </div>
      </div>
      <div
        class="w-[301px] h-[2px] mt-2 mx-auto"
        style="
          border-radius: 44.45px;
          background: radial-gradient(50% 50%, rgba(75, 75, 75, 0), rgb(75, 75, 75) 46%, rgba(75, 75, 75, 0) 94%);
          opacity: 0.5;
        "
      ></div>
      <div class="flex gap-x-2 px-[4px] mt-2">
        <button
          type="button"
          aria-haspopup="dialog"
          aria-expanded="false"
          data-state="closed"
          data-slot="drawer-trigger"
          class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive box-border border border-white/30 rounded-[10px] backdrop-blur-[181.9px] bg-gradient-to-b from-[#B3F106] to-[#5EFF03] px-4 py-2 has-[>svg]:px-3 flex-1 h-[40px] font-semibold w-full"
          @click="openStakePopup"
        >
          <svg
            viewBox="0 0 17.0325 17.0327"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            width="17.032471"
            height="17.032715"
            fill="none"
            customFrame="#000000"
          >
            <path
              id="Vector"
              d="M6.02196 0L6.02196 12.0439M12.0439 6.02196L6.02196 0L0 6.02196"
              fill-rule="nonzero"
              stroke="rgb(0,0,0)"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.72056103"
              transform="matrix(0.707826,0.706387,-0.706387,0.707826,8.50757,0)"
            ></path>
          </svg>
          <p class="text-[18px] text-black">Инвестировать</p>
        </button>
        <button
          data-slot="button"
          class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive box-border border border-white/20 rounded-[10px] shadow-[inset_0px_4px_4px_0px_rgba(255,255,255,0.25)] bg-gradient-to-b from-[rgb(45,45,45)] to-[rgb(33,33,33)] px-4 py-2 has-[>svg]:px-3 flex-1 h-[40px] font-semibold"
          :disabled="!canCollect || isCollecting"
          @click="handleCollectProfit"
        >
          <svg
            viewBox="0 0 30.6982 30.6982"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            width="30.698242"
            height="30.698242"
            fill="none"
            class="scale-[2.2] translate-y-[1px] translate-x-1"
          >
            <rect
              id="meteor-icons:arrow-up"
              width="21.707012"
              height="21.707012"
              x="0"
              y="0"
              fill="rgb(255,255,255)"
              fill-opacity="0"
              transform="matrix(-0.708296,-0.705915,0.705915,-0.708296,15.375,30.6982)"
            ></rect>
            <path
              id="Vector"
              d="M6.33121 0L6.33121 12.6624M12.6624 6.33121L6.33121 0L0 6.33121"
              fill-rule="nonzero"
              stroke="rgb(255,255,255)"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.72056103"
              transform="matrix(-0.708296,-0.705915,0.705915,-0.708296,15.364,24.3027)"
            ></path>
          </svg>
          <div v-if="isCollecting" class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
          <p v-else class="text-[18px] text-white">Собрать</p>
        </button>
      </div>
      <div
        class="w-[301px] h-[2px] mt-1 mx-auto"
        style="
          border-radius: 44.45px;
          background: radial-gradient(50% 50%, rgba(75, 75, 75, 0), rgb(75, 75, 75) 46%, rgba(75, 75, 75, 0) 94%);
          opacity: 0.5;
        "
      ></div>
    </div>
  </div>

  <!-- Popup для инвестирования -->
  <PopupMainStake v-model="isStakePopupOpen" />
</template>

<script setup>
import { ref, computed, onMounted, onUnmounted } from 'vue'
import PopupMainStake from './popup/popup-main-stake.vue'
import useStake from '../../../composables/stake.js'

// Реактивное состояние для управления popup
const isStakePopupOpen = ref(false)

// Composable для стейкинга
const { 
  stakeData, 
  isLoading,
  isCollecting,
  canCollect,
  collectProfit,
  loadStakeStats,
  startProfitUpdates,
  stopProfitUpdates,
  formatAmount,
  error 
} = useStake()

// Computed properties для форматирования
const formatBalance = computed(() => {
  return (amount) => {
    const parts = parseFloat(amount).toFixed(2).split('.')
    return `${parts[0]}<span class="text-[16px] opacity-60">.${parts[1]}</span>`
  }
})

const formatProfit = computed(() => {
  return (amount) => {
    return parseFloat(amount).toFixed(6)
  }
})

// Функция для открытия popup
const openStakePopup = () => {
  isStakePopupOpen.value = true
}

// Обработчик сбора прибыли
const handleCollectProfit = async () => {
  if (!canCollect.value || isCollecting.value) return
  
  try {
    console.log('🏦 Сбор прибыли со стейкинга')
    await collectProfit()
    
    // Обновляем данные после сбора
    await loadStakeStats()
    
  } catch (err) {
    console.error('❌ Ошибка сбора прибыли:', err)
  }
}

// Инициализация
onMounted(async () => {
  console.log('🚀 Инициализация компонента stake.vue')
  
  try {
    await loadStakeStats()
    
    // Запускаем автообновление если есть активный стейк
    if (stakeData.value.stakeBalance > 0) {
      startProfitUpdates()
    }
  } catch (err) {
    console.error('❌ Ошибка инициализации stake.vue:', err)
  }
})

// Очистка при размонтировании
onUnmounted(() => {
  stopProfitUpdates()
})
</script>

<style scoped>
/* Add any custom CSS here if needed, but styles are preserved via Tailwind and inline styles */
.spinning-ring {
  width: 58px;
  height: 58px;
  box-sizing: border-box;
  border-width: 2.78px;
  border-style: solid;
  border-color: rgb(181, 255, 7) rgb(181, 255, 7) rgb(181, 255, 7) rgba(181, 255, 7, 0);
  border-image: initial;
  animation: spin 3s linear infinite;
}

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}
</style>